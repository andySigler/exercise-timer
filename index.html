<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
            body, p, h1, h2, select {
                font-family: Helvetica;
            }
            h1 {
                font-size: 300px;
                width:100%;
                margin-top:0px;
            }
            h2 {
                font-size: 40px;
                width:100%;
            }
            .container {
                width: 100%;
                max-width: 600px;
                margin-top:80px;
                margin-right: auto;
                margin-left: auto;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <select id="exerciseSelect">
                <option value="simple">Simple</option>
                <option value="backFocus1">(Su) Back Focus 1</option>
                <option value="stretch">(M) Stretch</option>
                <option value="fullBody">(Tu) Full Body</option>
                <option value="coreFocus1">(W) Core Focus 1</option>
                <option value="backFocus2">(Th) Back Focus 2</option>
                <option value="stretch">(F) Stretch</option>
                <option value="coreFocus2">(Sa) Core Focus 2</option>
            </select>
            <span id="description"></span>
            <br>
            <input type="checkbox" id="randomCheckbox"> Randomize
            <button onclick="onResumePauseButtonPress()" id="resumePauseButton">Start</button>
            <button onclick="skip()">Skip</button>
            <h2 id="exerciseName"></h2>
            <h1 id="exerciseSeconds"></h1>
        </div>
    </body>
    <script type="text/javascript">
        var warmUps = [
            [
                {
                    name: 'Arms Up/Down',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Backward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Forward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Arm Rows',
                    seconds: 60,
                    extraWait: -15
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'Wall Shoulders',
                    seconds: 60
                },
                {
                    name: 'Chest Corner',
                    seconds: 45
                },
                {
                    name: 'Wall Lats Stretch',
                    seconds: 45
                },
                {
                    name: 'Chin Tucks',
                    seconds: 30
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'T-Spine Left',
                    seconds: 90,
                    extraWait: 10
                },
                {
                    name: 'T-Spine Right',
                    seconds: 90
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Cat Camel',
                    seconds: 2 * 60,
                    extraWait: 30
                },
                {
                    name: 'Hold Bird Dog Right',
                    seconds: 60
                },
                {
                    name: 'Hold Bird Dog Left',
                    seconds: 60
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Reverse Lunge',
                    seconds: 2 * 60
                }
                // {
                //     name: 'Rope Pulls',
                //     seconds: 60
                // }
            ],
            [
                {
                    name: 'Arms Up/Down',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Backward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Forward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Arm Rows',
                    seconds: 60,
                    extraWait: -15
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'Wall Shoulders',
                    seconds: 60
                },
                {
                    name: 'Chest Corner',
                    seconds: 45
                },
                {
                    name: 'Wall Lats Stretch',
                    seconds: 45
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'Cat Camel',
                    seconds: 2 * 60,
                    extraWait: 30
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Hold Bird Dog Right',
                    seconds: 60
                },
                {
                    name: 'Hold Bird Dog Left',
                    seconds: 60
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Rope Pulls',
                    seconds: 60,
                    extraWait: 10
                }
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // }
            ],
            [
                {
                    name: 'Arms Up/Down',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Backward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Forward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Arm Rows',
                    seconds: 60,
                    extraWait: -15
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'Wall Shoulders',
                    seconds: 60
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'Chin Tucks',
                    seconds: 60
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Reverse Lunge',
                    seconds: 2 * 60
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Rope Pulls',
                    seconds: 60,
                    extraWait: 10
                }
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // }
            ],
            [
                {
                    name: 'Arms Up/Down',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Backward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Shoulder Rotate Forward',
                    seconds: 30,
                    extraWait: -15
                },
                {
                    name: 'Arm Rows',
                    seconds: 60,
                    extraWait: -15
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'Wall Lats Stretch',
                    seconds: 45
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // },
                {
                    name: 'T-Spine Left',
                    seconds: 3 * 60,
                    extraWait: 10
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'T-Spine Right',
                    seconds: 3 * 60,
                    extraWait: 10
                },
                // {
                //     name: 'Bar Hang',
                //     seconds: 60,
                //     extraWait: 10
                // },
                {
                    name: 'Reverse Lunge',
                    seconds: 2 * 60
                }
                // {
                //     name: 'Bar Hang',
                //     seconds: 60
                // }
            ]
        ];
        var coolDown = [
            {
                name: 'Warrior Pose Right',
                seconds: 45
            },
            {
                name: 'Warrior Pose Left',
                seconds: 45
            },
            {
                name: 'Hamstring Right',
                seconds: 30,
                extraWait: 10
            },
            {
                name: 'Hamstring Left',
                seconds: 30,
                extraWait: -10
            },
            {
                name: 'Hamstring Right',
                seconds: 30,
                extraWait: -10
            },
            {
                name: 'Hamstring Left',
                seconds: 30,
                extraWait: -10
            }
        ];
        var exercises = {
            simple: {
                warmUp: 0,
                coolDown: true,
                steps: []
            },
            stretch: {
                warmUp: undefined,
                coolDown: true,
                steps: [
                    {
                        name: 'Stand Bird Dog',
                        seconds: 2 * 60
                    },
                    {
                        name: 'Straight Leg Raises',
                        seconds: 45
                    },
                    {
                        name: 'Raised Knee Hip Right',
                        seconds: 30
                    },
                    {
                        name: 'Raised Knee Hip Left',
                        seconds: 30
                    },
                    {
                        name: 'Reverse Plank',
                        seconds: 45
                    },
                    {
                        name: 'Asian Squat w/ Ball',
                        seconds: 60
                    },
                    {
                        name: 'Foam Roller Arcs',
                        seconds: 60,
                        extraWait: 10
                    },
                    {
                        name: 'Thread-Needle Right',
                        seconds: 90,
                        extraWait: 10
                    },
                    {
                        name: 'Thread-Needle Left',
                        seconds: 90
                    },
                    {
                        name: 'Lunge Hip-Flex Right',
                        seconds: 45
                    },
                    {
                        name: 'Lunge Hip-Flex Left',
                        seconds: 45
                    },
                    {
                        name: 'Elbow Lunge Right',
                        seconds: 45
                    },
                    {
                        name: 'Elbow Lunge Left',
                        seconds: 45
                    },
                    {
                        name: '90:90 Knee Right',
                        seconds: 45,
                        extraWait: 10
                    },
                    {
                        name: '90:90 Foot Right',
                        seconds: 45
                    },
                    {
                        name: '90:90 Knee Left',
                        seconds: 45,
                        extraWait: 10
                    },
                    {
                        name: '90:90 Foot Left',
                        seconds: 45
                    },
                    {
                        name: 'Sunrise',
                        seconds: 30
                    },
                    {
                        name: 'McKensie Push Ups',
                        seconds: 45
                    },
                    {
                        name: 'Lying Chest Right',
                        seconds: 45
                    },
                    {
                        name: 'Lying Chest Left',
                        seconds: 45
                    },
                    {
                        name: 'Groin Stretch',
                        seconds: 45
                    },
                    {
                        name: 'Butchers Block',
                        seconds: 60
                    },
                    {
                        name: 'Knee Tucks',
                        seconds: 30
                    },
                    {
                        name: 'Calf Right',
                        seconds: 30
                    },
                    {
                        name: 'Calf Left',
                        seconds: 30
                    }
                ]
            },
            fullBody: {
                // warmUp: 1,
                warmUp: 0,
                coolDown: true,
                steps: [
                    // {
                    //     name: 'Pull Ups',
                    //     seconds: 45,
                    //     extraWait: 10
                    // },
                    {
                        name: 'Wall Sit',
                        seconds: 60
                    },
                    {
                        name: 'Push Ups',
                        seconds: 45
                    },
                    {
                        name: 'Bicycle Crunches',
                        seconds: 60
                    },
                    {
                        name: 'Squats',
                        seconds: 60
                    },
                    {
                        name: 'Plank',
                        seconds: 60
                    },
                    {
                        name: 'Lying "W" Arms',
                        seconds: 60
                    },
                    {
                        name: 'Lunges',
                        seconds: 60
                    },
                    {
                        name: 'Push-Ups & Rotation',
                        seconds: 45
                    },
                    {
                        name: 'Lying Arm Raises',
                        seconds: 60
                    }
                ]
            },
            backFocus1: {
                // warmUp: 3,
                warmUp: 0,
                coolDown: true,
                steps: [
                    // {
                    //     name: 'Pull Ups',
                    //     seconds: 30,
                    //     extraWait: 10
                    // },
                    {
                        name: 'Stand-Twist Right',
                        seconds: 60,
                        extraWait: 20
                    },
                    {
                        name: 'Stand-Twist Left',
                        seconds: 60
                    },
                    {
                        name: '"I" Medicine Ball',
                        seconds: 60,
                        extraWait: 30
                    },
                    {
                        name: '"T" Medicine Ball',
                        seconds: 60
                    },
                    {
                        name: '"Y" Medicine Ball',
                        seconds: 60
                    },
                    {
                        name: 'Walking Superman 1',
                        seconds: 30,
                        extraWait: 20
                    },
                    {
                        name: 'Walking Superman 2',
                        seconds: 30
                    }
                ]
            },
            backFocus2: {
                // warmUp: 3,
                warmUp: 0,
                coolDown: true,
                steps: [
                    {
                        name: 'Elbow Right',
                        seconds: 90,
                        extraWait: 10
                    },
                    {
                        name: 'Elbow Left',
                        seconds: 90
                    },
                    {
                        name: 'Band Pull-Down',
                        seconds: 2 * 60,
                        extraWait: 20
                    },
                    {
                        name: 'Band Pull-Up Right',
                        seconds: 60,
                        extraWait: 20
                    },
                    {
                        name: 'Band Pull-Up Left',
                        seconds: 60
                    },
                    {
                        name: 'Walking Superman 1',
                        seconds: 30,
                        extraWait: 20
                    },
                    {
                        name: 'Walking Superman 2',
                        seconds: 30
                    }
                ]
            },
            coreFocus1: {
                // warmUp: 2,
                warmUp: 0,
                coolDown: true,
                steps: [
                    {
                        name: 'Dead Bug',
                        seconds: 2 * 60
                    },
                    {
                        name: 'Plank',
                        seconds: 60
                    },
                    {
                        name: 'Squats',
                        seconds: 60
                    },
                    {
                        name: 'Side Plank Right',
                        seconds: 60
                    },
                    {
                        name: 'Side Plank Left',
                        seconds: 60
                    },
                    {
                        name: 'Lying Leg Raises',
                        seconds: 45
                    }
                ]
            },
            coreFocus2: {
                // warmUp: 2,
                warmUp: 0,
                coolDown: true,
                steps: [
                    {
                        name: 'Dead Bug',
                        seconds: 2 * 60
                    },
                    {
                        name: 'Hip Bridge',
                        seconds: 60
                    },
                    {
                        name: 'V Sit',
                        seconds: 60
                    },
                    {
                        name: 'Bicycle',
                        seconds: 45
                    },
                    {
                        name: 'Knee Hip Raise Right',
                        seconds: 30
                    },
                    {
                        name: 'Knee Hip Raise Left',
                        seconds: 30
                    }
                    // {
                    //     name: 'Hanging Leg Raise',
                    //     seconds: 45,
                    //     extraWait: 20
                    // },
                    // {
                    //     name: 'Ball Crunches',
                    //     seconds: 45,
                    //     extraWait: 20
                    // }
                ]
            }
        };
        var schedule = [
            'backFocus1',    // Sunday
            'stretch',      // Monday
            'fullBody',     // Tuesday
            'coreFocus1',    // Wednesday
            'backFocus2',    // Thursday
            'stretch',      // Friday
            'coreFocus2',    // Saturday
        ];
        var restTime = 20;
        var fullExer = [];
        var interval = undefined;
        var currentSecond = 0;
        var currentStep = 0;
        var totalSecondCounter = 0;
        var totMinutes = 0;
        var shuffle = function (array) {
            var currentIndex = array.length;
            var temporaryValue, randomIndex;
            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        };
        function preloadExercise(autoDate) {
            var menu = document.getElementById('exerciseSelect');
            if (autoDate) {
                menu.value = schedule[new Date().getDay()];
            }
            fullExer = exercises[menu.value].steps.slice();
            var intro = [];
            var warmUpIndex = exercises[menu.value].warmUp;
            if (warmUpIndex !== undefined) {
                fullExer = warmUps[warmUpIndex].slice().concat(fullExer);
            }
            if (exercises[menu.value].coolDown) {
                fullExer = fullExer.concat(coolDown.slice());
            }
            calculateTimeRemaining();
            displayNameTime();
        }
        function calculateTimeRemaining() {
            var totalSteps = 0;
            totMinutes = fullExer.reduce((tot, val, i) => {
                if (currentStep <= i) {
                    totalSteps += 1;
                    tot += (val.seconds / 60);
                    if (val.extraWait) {
                        tot += (val.extraWait / 60)
                    }
                }
                return tot
            }, 0);
            totMinutes += (restTime * totalSteps) / 60;
            totalSecondCounter = Math.round(totMinutes * 60);
        }
        function getTimeRemainingString() {
            var min = Math.floor(totalSecondCounter / 60);
            min = String(min);
            if (min < 10) min = '0' + min;
            var sec = totalSecondCounter % 60;
            sec = String(sec);
            if (sec < 10) sec = '0' + sec;
            return min + ':' + sec;
        }
        function displayNameTime() {
            var exName = fullExer[currentStep].name;
            // exName += '<br>' + String(currentStep + 1) + ' / ' + String(fullExer.length);
            exName += '<br>' + getTimeRemainingString();
            document.getElementById('exerciseName').innerHTML = exName;
            var secondsDisplay = Math.floor(currentSecond);
            if (secondsDisplay >= 0) {
                secondsDisplay = fullExer[currentStep].seconds - secondsDisplay;
            }
            secondsDisplay = String(Math.abs(secondsDisplay));
            document.getElementById('exerciseSeconds').innerHTML = secondsDisplay;
        }
        function setColor(color) {
            document.body.style.backgroundColor = color;
        }
        function clearNameTime() {
            document.getElementById('exerciseName').innerHTML = 'Off';
            document.getElementById('exerciseSeconds').innerHTML = '...';
        }
        function beginNextStep() {
            currentStep += 1;
            if (currentStep >= fullExer.length) {
                stop();
                return;
            }
            currentSecond = restTime * -1;
            if (fullExer[currentStep].extraWait) {
                currentSecond -= fullExer[currentStep].extraWait
            }
        }
        function workoutStep() {
            totalSecondCounter -= 1;
            currentSecond += 1;
            if (currentSecond >= fullExer[currentStep].seconds) {
                beginNextStep();
            }
            if (currentSecond < 0) {
                displayNameTime();
                setColor('white');
            }
            else if (currentSecond < fullExer[currentStep].seconds){
                displayNameTime();
                setColor('rgb(0, 255, 123)');
            }
        }
        function onResumePauseButtonPress() {
            var btn = document.getElementById('resumePauseButton');
            if (btn.innerHTML === 'Start' || btn.innerHTML === 'Resume') {
                btn.innerHTML = 'Pause';
                start();
            }
            else if (btn.innerHTML === 'Pause') {
                btn.innerHTML = 'Resume';
                pause();
            }
        }
        function pause() {
            if (interval !== undefined) {
                clearInterval(interval);
                interval = undefined;
                setColor('white');
            }
        }
        function start() {
            if (document.getElementById('randomCheckbox').checked) {
                var selection = document.getElementById('exerciseSelect');
                var warmUpIndex = exercises[selection.value].warmUp;
                if (warmUpIndex !== undefined) {
                    fullExer = fullExer.slice(warmUps[warmUpIndex].length);
                }
                if (exercises[selection.value].coolDown) {
                    fullExer = fullExer.slice(
                        0, fullExer.length - coolDown.length);
                }
                fullExer = shuffle(fullExer);                  // shuffle
                if (warmUpIndex) {
                    fullExer = warmUps[warmUpIndex].slice().concat(fullExer);  // add warmup
                    fullExer = fullExer.concat(coolDown);  // add cooldown
                }
            }
            if (!interval) {
                interval = setInterval(workoutStep, 1000);
                workoutStep();
            }
        }
        function stop() {
            pause();
            clearNameTime();
            currentStep = 0;
            currentSecond = restTime * -1;
            setColor('grey');
        }
        function skip() {
            beginNextStep();
            calculateTimeRemaining();
            displayNameTime();
        }
        window.addEventListener('load', (event) => {
            document.getElementById('exerciseSelect').addEventListener('change', (e) => {
                preloadExercise();
            });
            stop();
            preloadExercise(true);
        });
        document.addEventListener('keydown', (event) => {
            console.log(event.keyCode);
            if(event.keyCode === 32) { // space
                onResumePauseButtonPress();
                event.preventDefault();
            }
            else if(event.keyCode === 39) { // arrow right
                skip();
                event.preventDefault();
            }
        }, false);
    </script>
</html>
