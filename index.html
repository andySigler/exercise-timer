<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
            body, p, h1, h2, select {
                font-family: Helvetica;
            }
            h1 {
                font-size: 300px;
                width:100%;
                margin-top:0px;
            }
            h2 {
                font-size: 40px;
                width:100%;
            }
            .container {
                width: 100%;
                max-width: 600px;
                margin-top:80px;
                margin-right: auto;
                margin-left: auto;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <select id="exerciseSelect">
                <option value="fullBody">Full Body</option>
                <option value="backFocus">Back Focus</option>
            </select>
            <span id="description"></span>
            <br>
            <input type="checkbox" id="randomCheckbox"> Randomize
            <button onclick="start()">Start</button>
            <button onclick="pause()">Pause</button>
            <button onclick="stop()">Stop</button>
            <button onclick="skip()">Skip</button>
            <h2 id="exerciseName"></h2>
            <h1 id="exerciseSeconds"></h1>
        </div>
    </body>
    <script type="text/javascript">
        var warmUp = [
            {
                name: 'Move Shoulders Around',
                seconds: 30
            },
            {
                name: 'Foam Roller',
                seconds: 60
            },
            {
                name: 'Lax Ball',
                seconds: 60
            },
            {
                name: 'Stand Rotate Shoulders',
                seconds: 30
            },
            {
                name: 'Wall Arm Raises',
                seconds: 60
            },
            {
                name: 'Corner Stretch',
                seconds: 30
            },
            {
                name: 'Wall Lats Stretch',
                seconds: 30
            },
            {
                name: 'T-Spine Left',
                seconds: 180
            },
            {
                name: 'T-Spine Right',
                seconds: 180
            },
            {
                name: 'Cat Camel',
                seconds: 180
            },
            {
                name: 'Bird Dog',
                seconds: 180
            }
        ]
        var exercises = {
            fullBody: [
                {
                    name: 'Wall Sit',
                    seconds: 30
                },
                {
                    name: 'Elbow Rotate Right',
                    seconds: 90
                },
                {
                    name: 'Elbow Rotate Left',
                    seconds: 90
                },
                {
                    name: 'Push Ups',
                    seconds: 30
                },
                {
                    name: 'Stomach Back Arcs',
                    seconds: 45
                },
                {
                    name: 'Crunches',
                    seconds: 30
                },
                {
                    name: 'Chair Step Up',
                    seconds: 45
                },
                {
                    name: 'Squats',
                    seconds: 30
                },
                {
                    name: 'Tricep Dips',
                    seconds: 30
                },
                {
                    name: 'Walking Superman',
                    seconds: 30
                },
                {
                    name: 'Plank',
                    seconds: 60
                },
                {
                    name: 'Stomach "W" Arms',
                    seconds: 30
                },
                {
                    name: 'High Stepping',
                    seconds: 30
                },
                {
                    name: 'Lunges',
                    seconds: 30
                },
                {
                    name: 'Push-Ups & Rotation',
                    seconds: 30
                },
                {
                    name: 'Birdy Arm Raises',
                    seconds: 30
                },
                {
                    name: 'Side Plank Right',
                    seconds: 30
                },
                {
                    name: 'Side Plank Left',
                    seconds: 30
                }
            ],
            backFocus: [
                {
                    name: 'Elbow Rotation Right',
                    seconds: 30
                },
                {
                    name: 'Elbow Rotation Left',
                    seconds: 30
                },
                {
                    name: 'Rope Pulls',
                    seconds: 30
                },
                {
                    name: 'Band Pull Down',
                    seconds: 30
                },
                {
                    name: 'Band Twist Pull Right',
                    seconds: 30
                },
                {
                    name: 'Band Twist Pull Left',
                    seconds: 30
                },
                {
                    name: 'Band Bird Dog Right',
                    seconds: 30
                },
                {
                    name: 'Band Bird Dog Left',
                    seconds: 30
                },
                {
                    name: 'Band Pull Up Right',
                    seconds: 30
                },
                {
                    name: 'Band Pull Up Left',
                    seconds: 30
                },
                {
                    name: '"I" Medicine Ball',
                    seconds: 30
                },
                {
                    name: '"T" Medicine Ball',
                    seconds: 30
                },
                {
                    name: '"Y" Medicine Ball',
                    seconds: 30
                },
                {
                    name: 'Walking Superman',
                    seconds: 30
                },
                {
                    name: 'Elbow Rotation Right',
                    seconds: 30
                },
                {
                    name: 'Elbow Rotation Left',
                    seconds: 30
                },
                {
                    name: 'Rope Pulls',
                    seconds: 30
                },
                {
                    name: 'Band Pull Down',
                    seconds: 30
                },
                {
                    name: 'Band Twist Pull Right',
                    seconds: 30
                },
                {
                    name: 'Band Twist Pull Left',
                    seconds: 30
                },
                {
                    name: 'Band Bird Dog Right',
                    seconds: 30
                },
                {
                    name: 'Band Bird Dog Left',
                    seconds: 30
                },
                {
                    name: 'Band Pull Up Right',
                    seconds: 30
                },
                {
                    name: 'Band Pull Up Left',
                    seconds: 30
                },
                {
                    name: '"I" Medicine Ball',
                    seconds: 30
                },
                {
                    name: '"T" Medicine Ball',
                    seconds: 30
                },
                {
                    name: '"Y" Medicine Ball',
                    seconds: 30
                },
                {
                    name: 'Walking Superman',
                    seconds: 30
                }
            ]
        };
        var restTime = 20;
        var fullExer = [];
        var interval = undefined;
        var currentSecond = 0;
        var currentStep = 0;
        var shuffle = function (array) {
            var currentIndex = array.length;
            var temporaryValue, randomIndex;
            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        };
        function preloadExercise() {
            var menu = document.getElementById('exerciseSelect');
            var exer = exercises[menu.value].slice();
            fullExer = warmUp.concat(exer);
            var description = document.getElementById('description');
            description.innerHTML = String(fullExer.length) + ' Steps';
            var totMinutes = fullExer.reduce((tot, val) => {
                return tot + (val.seconds / 60);
            }, 0);
            totMinutes += (restTime * fullExer.length) / 60;
            description.innerHTML += ' (' + String(Math.round(totMinutes)) + ' Minutes)'
        }
        function displayNameTime() {
            var exName = fullExer[currentStep].name;
            exName += '<br>' + String(currentStep + 1) + ' / ' + String(fullExer.length);
            document.getElementById('exerciseName').innerHTML = exName;
            var secondsDisplay = Math.floor(currentSecond);
            if (secondsDisplay >= 0) {
                secondsDisplay = fullExer[currentStep].seconds - secondsDisplay;
            }
            secondsDisplay = String(Math.abs(secondsDisplay));
            document.getElementById('exerciseSeconds').innerHTML = secondsDisplay;
        }
        function setColor(color) {
            document.body.style.backgroundColor = color;
        }
        function clearNameTime() {
            document.getElementById('exerciseName').innerHTML = '';
            document.getElementById('exerciseSeconds').innerHTML = '';
        }
        function workoutStep() {
            currentSecond += 1;
            if (currentSecond >= fullExer[currentStep].seconds) {
                currentSecond = restTime * -1;
                currentStep += 1;
                if (currentStep >= fullExer.length) {
                    console.log('done');
                    stop();
                }
            }
            if (currentSecond < 0) {
                displayNameTime();
                setColor('white');
            }
            else if (currentSecond < fullExer[currentStep].seconds){
                displayNameTime();
                setColor('rgb(0, 255, 123)');
            }
        }
        function pause() {
            if (interval) {
                clearInterval(interval);
                interval = undefined;
                setColor('white');
            }
        }
        function start() {
            if (document.getElementById('randomCheckbox').checked) {
                fullExer = shuffle(fullExer.slice(warmUp.length));
                // do not shuffle warm up
                fullExer = warmUp.slice().concat(fullExer);
            }
            if (!interval) {
                interval = setInterval(workoutStep, 1000);
                workoutStep();
            }
        }
        function stop() {
            pause();
            clearNameTime();
            currentStep = 0;
            currentSecond = restTime * -1;
        }
        function skip() {
            var oldStep = Math.floor(currentStep);
            var maxLen = Math.floor(fullExer.length);
            stop();
            currentStep = (oldStep + 1) % maxLen;
            start();

        }
        window.addEventListener('load', (event) => {
            document.getElementById('exerciseSelect').addEventListener('change', (e) => {
                preloadExercise();
            });
            preloadExercise();
            stop();
        });
    </script>
</html>
