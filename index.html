<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
            body, p, h1, h2, select {
                font-family: Helvetica;
            }
            h1 {
                font-size: 300px;
                width:100%;
                margin-top:0px;
            }
            h2 {
                font-size: 40px;
                width:100%;
            }
            .container {
                width: 100%;
                max-width: 600px;
                margin-top:80px;
                margin-right: auto;
                margin-left: auto;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <select id="exerciseSelect">
                <option value="backFocus">(Su/Th) Back Focus</option>
                <option value="stretch">(M/F) Stretch</option>
                <option value="fullBody">(Tu) Full Body</option>
                <option value="coreFocus">(W/Sa) Core Focus</option>
                <option value="simple">Simple</option>
            </select>
            <span id="description"></span>
            <br>
            <input type="checkbox" id="randomCheckbox"> Randomize
            <button onclick="start()">Start</button>
            <button onclick="pause()">Pause</button>
            <button onclick="stop()">Stop</button>
            <button onclick="skip()">Skip</button>
            <h2 id="exerciseName"></h2>
            <h1 id="exerciseSeconds"></h1>
        </div>
    </body>
    <script type="text/javascript">
        var warmUp = [
            {
                name: 'Bar Hang',
                seconds: 60
            },
            {
                name: 'Lax Ball',
                seconds: 90
            },
            {
                name: 'Rope Rotate',
                seconds: 60
            },
            {
                name: 'Wall Shoulders',
                seconds: 60
            },
            {
                name: 'Chest Corner',
                seconds: 45
            },
            {
                name: 'Wall Lats Stretch',
                seconds: 45
            },
            {
                name: 'Chin Tucks',
                seconds: 30
            },
            {
                name: 'Bar Hang',
                seconds: 60
            },
            {
                name: 'T-Spine Left',
                seconds: 90,
                extraWait: 10
            },
            {
                name: 'T-Spine Right',
                seconds: 90
            },
            {
                name: 'Bar Hang',
                seconds: 60,
                extraWait: 10
            },
            {
                name: 'Cat Camel',
                seconds: 2 * 60,
                extraWait: 10
            },
            {
                name: 'Hold Bird Dog Right',
                seconds: 60
            },
            {
                name: 'Hold Bird Dog Left',
                seconds: 60
            },
            {
                name: 'Bar Hang',
                seconds: 60,
                extraWait: 10
            },
            {
                name: 'Reverse Lunge',
                seconds: 2 * 60
            },
            {
                name: 'Rope Pulls',
                seconds: 60
            }
        ];
        var coolDown = [
            {
                name: 'Ball Foot Raises',
                seconds: 60 * 3,
                extraWait: 20
            },
            {
                name: 'Bar Hang',
                seconds: 60,
                extraWait: 10
            },
            {
                name: 'Hamstring Right',
                seconds: 30,
                extraWait: 20
            },
            {
                name: 'Hamstring Left',
                seconds: 30
            },
            {
                name: 'Hamstring Right',
                seconds: 30
            },
            {
                name: 'Hamstring Left',
                seconds: 30
            },
            {
                name: 'Bar Hang',
                seconds: 60
            }
        ];
        var exercises = {
            simple: {
                warmUp: true,
                coolDown: true,
                steps: []
            },
            stretch: {
                warmUp: false,
                coolDown: true,
                steps: [
                    {
                        name: 'Stand Bird Dog',
                        seconds: 3 * 60
                    },
                    {
                        name: 'Straight Leg Raises',
                        seconds: 45
                    },
                    {
                        name: 'Raised Knee Hip Right',
                        seconds: 30
                    },
                    {
                        name: 'Raised Knee Hip Left',
                        seconds: 30
                    },
                    {
                        name: 'Reverse Plank',
                        seconds: 45
                    },
                    {
                        name: 'Asian Squat w/ Ball',
                        seconds: 60
                    },
                    {
                        name: 'Neck Forward Back',
                        seconds: 30
                    },
                    {
                        name: 'Neck Side Side',
                        seconds: 30
                    },
                    {
                        name: 'Foam Roller Arcs',
                        seconds: 60,
                        extraWait: 10
                    },
                    {
                        name: 'Thread Needle Right 1',
                        seconds: 60,
                        extraWait: 10
                    },
                    {
                        name: 'Thread Needle Left 1',
                        seconds: 60
                    },
                    {
                        name: 'Thread Needle Right 2',
                        seconds: 60
                    },
                    {
                        name: 'Thread Needle Left 2',
                        seconds: 60
                    },
                    {
                        name: 'Stand Hamstring Right',
                        seconds: 60,
                        extraWait: 10
                    },
                    {
                        name: 'Stand Hamstring Left',
                        seconds: 60
                    },
                    {
                        name: 'Sunrise',
                        seconds: 30
                    },
                    {
                        name: 'McKensie Push Ups',
                        seconds: 45
                    },
                    {
                        name: 'Lying Chest Right',
                        seconds: 45
                    },
                    {
                        name: 'Lying Chest Left',
                        seconds: 45
                    },
                    {
                        name: 'Groin Stretch',
                        seconds: 45
                    },
                    {
                        name: 'Butchers Block',
                        seconds: 60
                    },
                    {
                        name: 'Knee Tucks',
                        seconds: 30
                    },
                    {
                        name: 'Lunge Hip-Flex Right',
                        seconds: 45
                    },
                    {
                        name: 'Lunge Hip-Flex Left',
                        seconds: 45
                    },
                    {
                        name: 'Elbow Lunge Right',
                        seconds: 45
                    },
                    {
                        name: 'Elbow Lunge Left',
                        seconds: 45
                    },
                    {
                        name: '90:90 Knee Right',
                        seconds: 45,
                        extraWait: 10
                    },
                    {
                        name: '90:90 Foot Right',
                        seconds: 45
                    },
                    {
                        name: '90:90 Knee Left',
                        seconds: 45,
                        extraWait: 10
                    },
                    {
                        name: '90:90 Foot Left',
                        seconds: 45
                    },
                    {
                        name: 'Calf Right',
                        seconds: 30
                    },
                    {
                        name: 'Calf Left',
                        seconds: 30
                    },
                    {
                        name: 'Quad Right',
                        seconds: 30
                    },
                    {
                        name: 'Quad Left',
                        seconds: 30
                    }
                ]
            },
            fullBody: {
                warmUp: true,
                coolDown: true,
                steps: [
                    {
                        name: 'Pull Ups 1',
                        seconds: 30,
                        extraWait: 10
                    },
                    {
                        name: 'Pull Ups 2',
                        seconds: 30
                    },
                    {
                        name: 'Wall Sit',
                        seconds: 60
                    },
                    {
                        name: 'Elbow Rotate Right',
                        seconds: 60
                    },
                    {
                        name: 'Elbow Rotate Left',
                        seconds: 60
                    },
                    {
                        name: 'Push Ups',
                        seconds: 45
                    },
                    {
                        name: 'Bicycle Crunches',
                        seconds: 60
                    },
                    {
                        name: 'Squats',
                        seconds: 60
                    },
                    {
                        name: 'Tricep Dips',
                        seconds: 45
                    },
                    {
                        name: 'Plank',
                        seconds: 60
                    },
                    {
                        name: 'Lying "W" Arms',
                        seconds: 60
                    },
                    {
                        name: 'Lunges',
                        seconds: 60
                    },
                    {
                        name: 'Push-Ups & Rotation',
                        seconds: 45
                    },
                    {
                        name: 'Lying Arm Raises',
                        seconds: 60
                    }
                ]
            },
            backFocus: {
                warmUp: true,
                coolDown: true,
                steps: [
                    {
                        name: 'Elbow Right 1',
                        seconds: 60,
                        extraWait: 10
                    },
                    {
                        name: 'Elbow Left 1',
                        seconds: 60
                    },
                    {
                        name: 'Elbow Right 2',
                        seconds: 60
                    },
                    {
                        name: 'Elbow Left 2',
                        seconds: 60
                    },
                    {
                        name: 'Pull Ups 1',
                        seconds: 30,
                        extraWait: 10
                    },
                    {
                        name: 'Pull Ups 2',
                        seconds: 30
                    },
                    {
                        name: 'Band Pull-Down',
                        seconds: 2 * 60,
                        extraWait: 20
                    },
                    {
                        name: 'Twist Right',
                        seconds: 60,
                        extraWait: 20
                    },
                    {
                        name: 'Twist Left',
                        seconds: 60
                    },
                    {
                        name: 'Band Pull-Up Right',
                        seconds: 60,
                        extraWait: 20
                    },
                    {
                        name: 'Band Pull-Up Left',
                        seconds: 60
                    },
                    {
                        name: '"I" Medicine Ball 1',
                        seconds: 45,
                        extraWait: 30
                    },
                    {
                        name: '"T" Medicine Ball 1',
                        seconds: 45
                    },
                    {
                        name: '"Y" Medicine Ball 1',
                        seconds: 45
                    },
                    {
                        name: '"I" Medicine Ball 2',
                        seconds: 45
                    },
                    {
                        name: '"T" Medicine Ball 2',
                        seconds: 45
                    },
                    {
                        name: '"Y" Medicine Ball 2',
                        seconds: 45
                    },
                    {
                        name: 'Walking Superman 1',
                        seconds: 30,
                        extraWait: 20
                    },
                    {
                        name: 'Walking Superman 2',
                        seconds: 30
                    }
                ]
            },
            coreFocus: {
                warmUp: true,
                coolDown: true,
                steps: [
                    {
                        name: 'Dead Bug',
                        seconds: 2 * 60
                    },
                    {
                        name: 'Plank',
                        seconds: 60
                    },
                    {
                        name: 'Squats',
                        seconds: 60
                    },
                    {
                        name: 'Side Plank Right',
                        seconds: 60
                    },
                    {
                        name: 'Side Plank Left',
                        seconds: 60
                    },
                    {
                        name: 'Lying Leg Raises',
                        seconds: 45
                    },
                    {
                        name: 'Hip Bridge',
                        seconds: 60
                    },
                    {
                        name: 'V Sit',
                        seconds: 60
                    },
                    {
                        name: 'Bicycle',
                        seconds: 45
                    },
                    {
                        name: 'Knee Hip Raise Right',
                        seconds: 30
                    },
                    {
                        name: 'Knee Hip Raise Left',
                        seconds: 30
                    },
                    {
                        name: 'Hanging Leg Raise',
                        seconds: 45,
                        extraWait: 20
                    },
                    {
                        name: 'Ball Crunches 1',
                        seconds: 30,
                        extraWait: 20
                    },
                    {
                        name: 'Ball Crunches 2',
                        seconds: 30
                    }
                ]
            }
        };
        var schedule = [
            'backFocus',    // Sunday
            'stretch',      // Monday
            'fullBody',     // Tuesday
            'coreFocus',    // Wednesday
            'backFocus',    // Thursday
            'stretch',      // Friday
            'coreFocus',    // Saturday
        ];
        var restTime = 20;
        var fullExer = [];
        var interval = undefined;
        var currentSecond = 0;
        var currentStep = 0;
        var totalSecondCounter = 0;
        var totMinutes = 0;
        var shuffle = function (array) {
            var currentIndex = array.length;
            var temporaryValue, randomIndex;
            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        };
        function preloadExercise(autoDate) {
            var menu = document.getElementById('exerciseSelect');
            if (autoDate) {
                menu.value = schedule[new Date().getDay()];
            }
            fullExer = exercises[menu.value].steps.slice();
            var intro = [];
            if (exercises[menu.value].warmUp) {
                fullExer = warmUp.slice().concat(fullExer);
            }
            if (exercises[menu.value].coolDown) {
                fullExer = fullExer.concat(coolDown.slice());
            }
            calculateTimeRemaining();
            displayNameTime();
        }
        function calculateTimeRemaining() {
            var totalSteps = 0;
            totMinutes = fullExer.reduce((tot, val, i) => {
                if (currentStep <= i) {
                    totalSteps += 1;
                    tot += (val.seconds / 60);
                    if (val.extraWait) {
                        tot += (val.extraWait / 60)
                    }
                }
                return tot
            }, 0);
            totMinutes += (restTime * totalSteps) / 60;
            totalSecondCounter = Math.round(totMinutes * 60);
        }
        function getTimeRemainingString() {
            var min = Math.floor(totalSecondCounter / 60);
            min = String(min);
            if (min < 10) min = '0' + min;
            var sec = totalSecondCounter % 60;
            sec = String(sec);
            if (sec < 10) sec = '0' + sec;
            return min + ':' + sec;
        }
        function displayNameTime() {
            var exName = fullExer[currentStep].name;
            // exName += '<br>' + String(currentStep + 1) + ' / ' + String(fullExer.length);
            exName += '<br>' + getTimeRemainingString();
            document.getElementById('exerciseName').innerHTML = exName;
            var secondsDisplay = Math.floor(currentSecond);
            if (secondsDisplay >= 0) {
                secondsDisplay = fullExer[currentStep].seconds - secondsDisplay;
            }
            secondsDisplay = String(Math.abs(secondsDisplay));
            document.getElementById('exerciseSeconds').innerHTML = secondsDisplay;
        }
        function setColor(color) {
            document.body.style.backgroundColor = color;
        }
        function clearNameTime() {
            document.getElementById('exerciseName').innerHTML = 'Off';
            document.getElementById('exerciseSeconds').innerHTML = '...';
        }
        function workoutStep() {
            totalSecondCounter -= 1;
            currentSecond += 1;
            if (currentSecond >= fullExer[currentStep].seconds) {
                currentStep += 1;
                if (currentStep >= fullExer.length) {
                    stop();
                    return;
                }
                currentSecond = restTime * -1;
                if (fullExer[currentStep].extraWait) {
                    currentSecond -= fullExer[currentStep].extraWait
                }
            }
            if (currentSecond < 0) {
                displayNameTime();
                setColor('white');
            }
            else if (currentSecond < fullExer[currentStep].seconds){
                displayNameTime();
                setColor('rgb(0, 255, 123)');
            }
        }
        function pause() {
            if (interval !== undefined) {
                clearInterval(interval);
                interval = undefined;
                setColor('white');
            }
        }
        function start() {
            if (document.getElementById('randomCheckbox').checked) {
                var selection = document.getElementById('exerciseSelect');
                if (exercises[selection.value].warmUp) {
                    fullExer = fullExer.slice(warmUp.length);
                }
                if (exercises[selection.value].coolDown) {
                    fullExer = fullExer.slice(
                        0, fullExer.length - coolDown.length);
                }
                fullExer = shuffle(fullExer);                  // shuffle
                if (exercises[selection.value].warmUp) {
                    fullExer = warmUp.slice().concat(fullExer);  // add warmup
                }
                if (exercises[selection.value].warmUp) {
                    fullExer = fullExer.concat(coolDown);  // add cooldown
                }
            }
            if (!interval) {
                interval = setInterval(workoutStep, 1000);
                workoutStep();
            }
        }
        function stop() {
            pause();
            clearNameTime();
            currentStep = 0;
            currentSecond = restTime * -1;
            setColor('grey');
        }
        function skip() {
            var oldStep = Math.floor(currentStep);
            var maxLen = Math.floor(fullExer.length);
            stop();
            currentStep = (oldStep + 1) % maxLen;
            if (fullExer[currentStep].extraWait) {
                currentSecond -= fullExer[currentStep].extraWait
            }
            calculateTimeRemaining();
            start();

        }
        window.addEventListener('load', (event) => {
            document.getElementById('exerciseSelect').addEventListener('change', (e) => {
                preloadExercise();
            });
            stop();
            preloadExercise(true);
        });
    </script>
</html>
